generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(uuid()) @map("UserId")
  firstName   String   @map("FirstName")
  lastName    String   @map("LastName")
  userName    String   @unique @map("UserName")
  emailAdress String   @unique @map("EmailAdress")
  password    String   @map("password")
  role        String   @default("user") @map("Role")
  isActive    Boolean  @default(true) @map("IsActive") 
  isDeleted   Boolean  @default(false) @map("IsDeleted")
  dateJoined  DateTime @default(now()) @map("DateJoined")
  lastUpdated DateTime @updatedAt @map("LastUpdated")
  posts       Blog[]

  @@map("Users")
}

model Blog {
  id               String   @id @default(uuid()) @map("PostId")
  title            String   @map("Title")
  synopsis         String   @map("Synopsis")
  featuredImageUrl String   @map("FeaturedImageUrl")
  content          String   @db.Text @map("Content") 
  isDeleted        Boolean  @default(false) @map("IsDeleted")
  isDisabled       Boolean  @default(false) @map("IsDisabled") // NEW: For admin to disable harmful blogs
  disabledReason   String?  @map("DisabledReason") // NEW: Reason for disabling
  disabledAt       DateTime? @map("DisabledAt") // NEW: When it was disabled

  // Analytics fields ONLY
  viewCount        Int      @default(0) @map("ViewCount")
  likesCount       Int      @default(0) @map("LikesCount")
  commentsCount    Int      @default(0) @map("CommentsCount")

  createdAt        DateTime @default(now()) @map("CreatedAt")
  lastUpdated      DateTime @updatedAt @map("LastUpdated")
  userId           String   @map("UserId")
  user             User     @relation(fields: [userId], references: [id])
  
  categoryId       String?  @map("CategoryId")
  category         Category? @relation(fields: [categoryId], references: [id])

  @@map("Blogs")
}

model Category {
  id        String  @id @default(uuid()) @map("CategoryId")
  name      String  @unique @map("Name")
  blogs     Blog[]  

  @@map("Categories")
}